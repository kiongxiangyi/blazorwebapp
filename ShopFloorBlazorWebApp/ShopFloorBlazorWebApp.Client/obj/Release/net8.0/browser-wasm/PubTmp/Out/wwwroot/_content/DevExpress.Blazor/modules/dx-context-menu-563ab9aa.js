import{_ as e}from"./_tslib-6e8ca86b.js";import{F as t,K as s,a as i,D as o}from"./keyboard-navigation-strategy-01c5be51.js";import{S as a}from"./single-slot-element-base-3afabaf0.js";import{k as r}from"./key-f9cbed1b.js";import{a as n,b as d,P as l,K as c,d as m,e as p,c as h}from"./menu-keyboard-strategy-cdfcaa74.js";import{s as u}from"./popup-c5041db5.js";import{e as b}from"./custom-element-267f9a21.js";import"./focushelper-cb993bae.js";import"./logicaltreehelper-7b19cc30.js";import"./layouthelper-0c7c89da.js";import"./point-e4ec110e.js";import"./constants-791d6f9b.js";import"./custom-events-helper-e7f279d3.js";import"./eventhelper-8570b930.js";import"./focus-utils-405a64a8.js";import"./touch-4bff3f51.js";import"./browser-d96520d8.js";import"./common-f853e871.js";import"./disposable-d2c2d283.js";import"./dom-utils-dfeed069.js";import"./dom-da46d023.js";import"./css-classes-cee8476c.js";import"./data-qa-utils-8be7c726.js";import"./const-90026e45.js";import"./dx-ui-element-dd33ec67.js";import"./lit-element-base-29f49d31.js";import"./dx-license-1f911fcd.js";import"./lit-element-462e7ad3.js";import"./property-4ec0b52d.js";import"./constants-3937401e.js";import"./rafaction-bba7928b.js";import"./screenhelper-cc818363.js";import"./transformhelper-ebad0156.js";import"./positiontracker-896b964e.js";import"./branch-e081818f.js";import"./capturemanager-43e041e5.js";import"./portal-8366b474.js";import"./constants-058ebb50.js";import"./dx-html-element-pointer-events-helper-1557f7d5.js";import"./devices-afeafb19.js";import"./nameof-factory-64d95f5b.js";import"./focustrap-8a58142c.js";class y extends l{constructor(e,t,s){super(e,t),this._parentStrategy=s,this.selectedItemIndex=-1}get parentStrategy(){return this._parentStrategy}initialize(){super.initialize(),this.targetElement.setAttribute(c,"")}activate(){this.selectedItemIndex>=0&&super.activate()}updateSelectedItemByIndex(e){e>=0&&super.updateSelectedItemByIndex(e)}queryItems(){return this.queryItemsBySelector(".dxbl-context-menu-item, .dxbl-context-menu-template")}onActiveStateChanged(e){e||(this.selectedItemElement&&t.removeTabIndex(this.selectedItemElement),t.removeTabIndex(this.targetElement))}doAction(e){this.selectedItemElement&&(this.doClick(this.selectedItemElement,e),n(this.selectedItemElement)&&this.openSubMenu(d.First))}async openSubMenu(e){this.requestSubMenuOpen();const t=await this.waitSubMenuShown();e===d.Last?t.focusLastItem():t.focusFirstItem()}handlePopupShown(){this.parentStrategy.onSubMenuShown(this),this.focusContainer()}handlePopupClosed(){this.parentStrategy.onSubMenuClosed(this)}onSubMenuClosed(e){super.onSubMenuClosed(e),this.focusContainer()}focusContainer(){const e=t.findFocusableElements(this.targetElement);e.length>0&&t.focusElement(e[0])}createSubMenuStrategy(e,t){return new g(e,t,this)}}class f extends y{closeSelf(){return!!n(this.selectedItemElement)&&(this.openSubMenu(d.Last),!0)}}class g extends y{closeSelf(){const e=this.targetElement.placementTargetElement;return!!e&&(e.dispatchEvent(new m(p.Collapse)),this.parentStrategy.updateSelectedItemByChildElement(e),this.parentStrategy.focusSelectedItem(),!0)}}class v extends s{constructor(e,t){super(e,t),this._prevActiveElement=null,this.boundHandlePopupKeyboardStrategyCreating=this.handlePopupKeyboardStrategyCreating.bind(this),this.targetElement.addEventListener(u.eventName,this.boundHandlePopupKeyboardStrategyCreating)}queryItems(){return this.queryItemsBySelector(".dxbl-dropdown-dialog")}onSubMenuShown(e){this._prevActiveElement||(this._prevActiveElement=document.activeElement)}onSubMenuClosed(e){e.targetElement.isConnected&&!h(e.targetElement)||this.tryRestoreFocusedElement()}handlePopupKeyboardStrategyCreating(e){e.detail.factory={createPopup:(e,t)=>new f(e,t,this)},e.stopPropagation()}handleKeyDown(e){return r.KeyUtils.getEventKeyCode(e)!==r.KeyCode.Tab||this.nestedContentSelected?super.handleKeyDown(e):(this.performShortcutEvent(e),e.shiftKey?this.leaveBackward():this.leaveForward(),!0)}tryRestoreFocusedElement(){this._prevActiveElement&&this._prevActiveElement instanceof HTMLElement&&(this._prevActiveElement.focus(),this._prevActiveElement=null)}}let j=class extends a{constructor(){super(),this._keyboardNavigator=null,this.bindedOnChanged=this.onChanged.bind(this),this._observer=new MutationObserver(this.bindedOnChanged)}onChanged(e,t){null==e||e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof i&&(this._keyboardNavigator=e,this.initializeKeyboardNavigation())}))}))}connectedCallback(){this._keyboardNavigator=this.querySelector(o),this._keyboardNavigator?this.initializeKeyboardNavigation():this._observer.observe(this,{childList:!0})}initializeKeyboardNavigation(){this._keyboardNavigator&&!this._keyboardNavigator.initialized&&this._keyboardNavigator.initialize(this,new v(this._keyboardNavigator,this))}disconnectedCallback(){var e;this._observer.disconnect(),null===(e=this._keyboardNavigator)||void 0===e||e.disposeComponent()}};j=e([b("dxbl-context-menu")],j);const S={loadModule:function(){}};export{j as DxContextMenu,S as default};
