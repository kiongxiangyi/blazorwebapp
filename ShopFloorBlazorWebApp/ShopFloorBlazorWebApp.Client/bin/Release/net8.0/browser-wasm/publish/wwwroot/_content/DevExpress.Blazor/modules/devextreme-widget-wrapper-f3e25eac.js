import{g as e,W as t}from"./custom-theme-generator-7fa40928.js";import{_ as s}from"./_tslib-6e8ca86b.js";import{S as i}from"./single-slot-element-base-3afabaf0.js";import{C as n}from"./custom-events-helper-e7f279d3.js";import{registerTrialPanelComponents as o}from"./dx-license-1f911fcd.js";import{n as r}from"./property-4ec0b52d.js";import{d as a}from"./dom-da46d023.js";import{C as d}from"./css-classes-cee8476c.js";import{i as p}from"./dom-utils-dfeed069.js";const l="dxbl-client-component-wrapper";class c extends CustomEvent{constructor(e){super(e,{detail:new m,bubbles:!0,composed:!0,cancelable:!0})}}class h extends CustomEvent{constructor(e){super(h.eventName,{detail:new u(e),bubbles:!0,composed:!0,cancelable:!0})}}h.eventName=`${l}.options-loaded`;class g extends CustomEvent{constructor(e){super(g.eventName,{detail:new C(e),bubbles:!0,composed:!0,cancelable:!0})}}g.eventName=`${l}.loading-panel-visibility-changed`;class m{}class u{constructor(e){this.OptionChunkKeys=e}}class C{constructor(e){this.Visible=e}}n.register(h.eventName,(e=>e.detail)),n.register(g.eventName,(e=>e.detail)),o();const f=e=>e&&"object"==typeof e&&!Array.isArray(e);class O extends i{constructor(){super(...arguments),this.optionChunks="",this._firstLoading=!0,this._loadedChunks=[]}connectedOrContentChanged(){super.connectedOrContentChanged(),this.createComponentIfRequired()}disconnectedCallback(){super.disconnectedCallback(),this.disposeComponent()}firstUpdated(){this._firstLoading=!1}createComponentIfRequired(){if(!this.canCreateComponent())return;const e={};this.deepAssign(e,this.createInitOptions(),this.getServerOptions()),this.createComponent(e)}processSpecialOptions(e){}willUpdate(e){if(!this._firstLoading&&e.has("optionChunks")){const e=this.getServerOptions();e&&this.updateComponent(e)}}parseServerOptions(e){const t=e&&JSON.parse(e);if(!t)return;const s=Object.keys(t).filter((e=>!this._loadedChunks.includes(e))),i=s.map((e=>t[e])),n=this.deepAssign({},...i);return this.processSpecialOptions(n),this.invokeOptionsLoadedEvent(s),this._loadedChunks.push(...s),n}deepAssign(e,...t){if(!t.length)return e;const s=t.shift();if(f(e)&&f(s))for(const[t,i]of Object.entries(s))f(i)?(e[t]||(e[t]={}),this.deepAssign(e[t],i)):e[t]=i;return this.deepAssign(e,...t)}resetEmptyOptions(e,t,s=""){if(!t)return;const i=Object.entries(t).filter((([e])=>!this.getSkippedEmptyOptions().includes(s+e)));for(const[n,o]of i){const i=s+n;Array.isArray(o)?o.forEach(((t,s)=>{f(t)&&this.resetEmptyOptions(e,t,`${i}[${s}].`)})):f(o)&&this.resetEmptyOptions(e,o,`${i}.`),null===o&&(delete t[n],e(i))}}changeLoadingPanelVisibility(e){this.dispatchEvent(new g(e))}invokeOptionsLoadedEvent(e){this.dispatchEvent(new h(e))}getServerOptions(){return this.parseServerOptions(this.optionChunks)}getSkippedEmptyOptions(){return[]}}s([r({attribute:"option-chunks"})],O.prototype,"optionChunks",void 0);const v="dxInstance",b="width",y="height",W="visible";class S extends O{constructor(){super(...arguments),this._containerSizeChanged=!1}canCreateComponent(){return!this._widgetPromise&&!!this.getWidgetElement()}createComponent(e){this._widgetPromise=this.initializeWidget(e)}disposeComponent(){var e;null===(e=this._widgetPromise)||void 0===e||e.then((e=>this.disposeWidget(e))).catch((e=>{p(this)||console.error(e)}))}disposeWidget(e){e.dispose()}updateComponent(e){var t;Object.keys(e).length?null===(t=this._widgetPromise)||void 0===t||t.then((t=>this.updateWidgetOptions(t,e))):this._containerSizeChanged&&this.onlyContainerSizeChanged()}createInitOptions(){return{...this.createWidgetDefaultOptions(),...this.createWidgetHandlers()}}createWidgetDefaultOptions(){return{}}createWidgetHandlers(){return{onInitialized:e=>this.onWidgetInitialized(e),onDisposing:e=>this.onWidgetDisposing(e)}}getWidgetCustomTheme(){return e(this.getThemeDependentOptionsDict(),this.getWidgetTypeName(),this)}getThemeDependentOptionsDict(){return{}}async initializeWidget(e){const t=this.getWidgetCustomTheme();t&&(await this.widgetLoader.registerCustomTheme(t),e.theme=t.name);const s=this.getWidgetElement(),i=this.getWidgetTypeName();return this.widgetLoader.initializeWidget(s,i,e)}get widgetLoader(){var e;return null!==(e=this._loader)&&void 0!==e||(this._loader=t.getInstance()),this._loader}getWidgetElement(){return this.getElementsByClassName(this.getWidgetElementClassName())[0]}getWidgetElementClassName(){return"dxbl-widget-container"}updateWidgetOptions(e,t){e.beginUpdate(),this.resetEmptyOptions((t=>{e.resetOption(t)}),t),e.option(t),e.endUpdate()}onWidgetInitialized(e){e.element[v]=e.component}onWidgetDisposing(e){delete e.element[v]}setStyleOptionForElement(e,t){this.getContainerToSetStyle().style.setProperty(e,t)}processSpecialOptions(e){const t=void 0!==e[b],s=void 0!==e[y];this._containerSizeChanged=t||s,t&&(this.setStyleOptionForElement(b,`${e[b]}`),delete e[b]),s&&(this.setStyleOptionForElement(y,`${e[y]}`),delete e[y]),void 0!==e[W]&&a.DomUtils.toggleClassName(this,d.Invisible,!e[W])}getContainerToSetStyle(){return this}onlyContainerSizeChanged(){this.changeLoadingPanelVisibility(!1)}executeClientMethod(e,...t){return this._widgetPromise?this._widgetPromise.then((s=>s[e](...t))):Promise.resolve()}}export{c as C,S as D};
